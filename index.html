<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Typhoon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link rel="shortcut icon" href="assets/img/typhoon.ico">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        // Function to show instructions
        function showInstructions(sectionId) {
          $('.instructions').hide(); // Hide all sections
          const $selectedSection = $('#' + sectionId);
          $selectedSection.show(); // Show the selected section
          $selectedSection[0].scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to the section
        }

        // Attach click event to buttons
        $('.btn-ubuntu, .btn-windows, .btn-source').on('click', function (e) {
          const sectionId = $(this).data('section');
          if (sectionId) {
            e.preventDefault();
            showInstructions(sectionId);
          }
        });

        // Function to update Flatpak and .deb links and fetch the latest version
        async function updateFlatpakLink() {
          const $flatpakButton = $('.btn-rpm');
          const $debTextLinks = $('[id="deb-text-link"]'); // Select all elements with the ID 'deb-text-link'
          const $versionElement = $('#latest-version'); // Select the element to display the latest version

          try {
            const response = await fetch('https://api.github.com/repos/archisman-panigrahi/typhoon/releases/latest');
            if (!response.ok) throw new Error('Failed to fetch release info');
            const release = await response.json();

            // Update Flatpak link
            const latestFlatpakUrl = release.assets.find(asset => asset.name.endsWith('.rpm'))?.browser_download_url;
            if (latestFlatpakUrl) {
              $flatpakButton.attr('href', latestFlatpakUrl);
            }

            // Update .deb links
            const latestDebUrl = release.assets.find(asset => asset.name.endsWith('.deb'))?.browser_download_url;
            if (latestDebUrl) {
              $debTextLinks.attr('href', latestDebUrl); // Update all elements with the ID 'deb-text-link'
            }

            // Update the latest version
            const latestVersion = release.tag_name.replace(/^v/, ''); // Remove the 'v' prefix
            $versionElement.text(`Latest Version: ${latestVersion}`);
          } catch (error) {
            console.error('Error updating links or fetching version:', error);
            $versionElement.text('Latest Version: Unable to fetch');
          }
        }

        // Initialize the function on page load
        updateFlatpakLink();
      });
    </script>
  </head>
  <body>
    <div class="content">
      <h1>Typhoon</h1>
      <p>
        <a href="webapp.html">
            <img src="assets/img/typhoon.png" width="206.4" height="344" alt="Typhoon" title="Click to open the web app">
        </a>
      </p>
      <p class="lead">
        Typhoon is a stylish weather app for <a href="https://en.wikipedia.org/wiki/Linux" target="_blank">GNU/Linux</a><br>
        <span id="latest-version">Fetching latest version...</span>
      </p>
      
      <!-- Buttons to show installation instructions -->
      <div class="buttons">
        <a class="btn-ubuntu" data-section="ubuntu-instructions">Ubuntu/Mint (PPA/DEB)</a>
        <a class="btn-rpm" href="">Fedora (RPM)</a>
        <a class="btn-ubuntu" style="background-color: #411e86;" data-section="other-gnu-linux-instructions">Other GNU/Linux</a>
        <a class="btn-site" href="webapp.html">Webapp</a>
        <a class="btn-windows" href="">Windows (coming soon)</a>
        <a class="btn-source" href="https://github.com/archisman-panigrahi/typhoon" target="_blank">Source Code</a>
      </div>
      
      <!-- GNU/Linux Installation Instructions -->
      <div id="ubuntu-instructions" class="instructions" style="display: none;">
        <h2>Ubuntu 22.04+: Open a terminal and add the <a href="https://launchpad.net/~apandada1/+archive/ubuntu/typhoon" target="_blank">official PPA</a> to install Typhoon</h2>
        <pre><code>sudo add-apt-repository ppa:apandada1/typhoon

sudo apt update

sudo apt install typhoon</code></pre>
      Alternatively, <a id="deb-text-link" href="https://github.com/archisman-panigrahi/typhoon/releases" target="_blank">download the latest .deb installer</a> from GitHub Releases.<br>
      Ubuntu 20.04: Use the .deb package.
      </div>
      
      <div id="other-gnu-linux-instructions" class="instructions" style="display: none;">
        <a href="https://repology.org/project/typhoon/versions">
          <img src="https://repology.org/badge/vertical-allrepos/typhoon.svg" alt="Packaging status" align="center">
        </a>
        <h2>Installation Instructions for GNU/Linux</h2>
        <ul>
          <li>
            <strong>Arch Linux:</strong> Install from the <a href="https://aur.archlinux.org/packages/typhoon" target="_blank">AUR</a> using your favorite AUR helper:
            <pre><code>yay -S typhoon</code></pre>
          </li>
          <li>
            <strong>Debian/Chrome OS:</strong> <a id="deb-text-link" href="https://github.com/archisman-panigrahi/typhoon/releases" target="_blank">Download the latest .deb file</a> from GitHub releases.
          </li>
          <li>
            <strong>Other Distributions:</strong> Download the source code from <a href="https://github.com/archisman-panigrahi/typhoon" target="_blank">GitHub</a> and build it manually:
            <pre><code>git clone https://github.com/archisman-panigrahi/typhoon.git

cd typhoon

meson setup builddir --prefix=/usr

sudo meson install -C builddir</code></pre>
          </li>
        </ul>
      </div>
    </div>
  </body>
</html>
